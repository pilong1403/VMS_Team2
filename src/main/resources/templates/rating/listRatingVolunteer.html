<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Danh s√°ch ƒê√°nh gi√° T√¨nh nguy·ªán vi√™n</title>
    <link rel="stylesheet" th:href="@{/css/rate.css}">
</head>
<body>
<div class="app">
    <aside class="sidebar">
        <div class="title">Qu·∫£n l√Ω ƒê√°nh gi√°</div>
        <nav class="nav">
            <a class="active" th:href="@{/ratings}">Danh s√°ch ƒë√°nh gi√°</a>
            <a th:href="@{/ratings/create}">ƒê√°nh gi√° t√¨nh nguy·ªán vi√™n</a>
        </nav>
        <div class="user-mini">
            <img th:src="${currentUser.avatarUrl != null ? currentUser.avatarUrl : 'https://i.pravatar.cc/100?img=5'}" alt="admin">
            <div>
                <div th:text="${currentUser.fullName}">Nguy·ªÖn VƒÉn A</div>
                <div style="color:#9ca3af;font-size:12px" th:text="${currentUser.role.roleName}">Admin</div>
            </div>
        </div>
    </aside>

    <main class="main">
        <div class="header">
            <div>
                <h2 style="margin:0">Danh s√°ch ƒê√°nh gi√° T√¨nh nguy·ªán vi√™n</h2>
                <div class="muted">
                    Qu·∫£n l√Ω v√† theo d√µi ƒë√°nh gi√° c·ªßa c√°c t√¨nh nguy·ªán vi√™n thu·ªôc
                    <b th:text="${currentOrg.name}">T√™n t·ªï ch·ª©c</b>
                </div>
            </div>
            <div class="badges">
                <span class="badge warning" th:text="${pendingCount + ' ch·ªù ƒë√°nh gi√°'}">0 ch·ªù ƒë√°nh gi√°</span>
                <span class="badge success" th:text="${doneCount + ' ƒë√£ ƒë√°nh gi√°'}">0 ƒë√£ ƒë√°nh gi√°</span>
            </div>
        </div>

        <div class="toolbar">
            <form th:action="@{/ratings}" method="get" style="display:flex;gap:10px;align-items:center;">
                <div class="search">
                    <span class="icon">üîé</span>
                    <input id="search" type="text" name="keyword" th:value="${keyword}" placeholder="T√¨m ki·∫øm...">
                </div>

                <select id="statusSelect" name="stars" class="select">
                    <option th:value="''" th:selected="${filteredStars == null}">T·∫•t c·∫£ sao</option>
                    <option th:each="i : ${#numbers.sequence(1,5)}"
                            th:value="${i}"
                            th:text="${i + ' sao'}"
                            th:selected="${filteredStars == i}"></option>
                </select>

                <button type="submit" class="btn primary">L·ªçc</button>
            </form>
        </div>

        <section class="list">
            <div th:if="${#lists.isEmpty(ratings)}" style="padding:20px;text-align:center;color:#6b7280">
                Kh√¥ng c√≥ ƒë√°nh gi√° n√†o.
            </div>

            <div class="card" th:each="r : ${ratings}">
                <div class="card-head">
                    <img class="avatar"
                         th:src="${r.rateeUser.avatarUrl != null ? r.rateeUser.avatarUrl : 'https://i.pravatar.cc/100'}" alt="avatar">
                    <div class="info">
                        <div class="name" th:text="${r.rateeUser.fullName}">T√™n TNV</div>
                        <div class="muted"
                             th:text="${#temporals.format(r.opportunity.startTime, 'dd/MM/yyyy')} + ' - ' + r.opportunity.title">
                            Ng√†y - Ho·∫°t ƒë·ªông
                        </div>
                    </div>
                    <span class="pill"
                          th:classappend="${r.stars == null} ? ' gray' : ''"
                          th:text="${r.stars == null ? 'Ch·ªù ƒë√°nh gi√°' : 'ƒê√£ ƒë√°nh gi√°'}">
                        ƒê√£ ƒë√°nh gi√°
                    </span>
                </div>

                <div class="card-body">
                    <div>
                        <div class="meta">
                            <span th:text="${r.opportunity.title}">Ho·∫°t ƒë·ªông</span>
                            <span class="dot"></span>
                            <span th:text="${r.createdAt != null ? #temporals.format(r.createdAt, 'dd/MM/yyyy') : 'Ch∆∞a t·∫°o'}">Ng√†y t·∫°o</span>
                        </div>
                        <div class="quote"
                             th:text="${r.comment != null ? '‚Äú' + r.comment + '‚Äù' : 'Ch∆∞a c√≥ nh·∫≠n x√©t.'}">
                            ‚ÄúC·∫£m ∆°n v√¨ s·ª± ƒë√≥ng g√≥p!‚Äù
                        </div>
                    </div>
                    <div class="org">
                        <div class="rating">
                            <span th:each="i : ${#numbers.sequence(1,5)}"
                                  th:text="${i <= (r.stars != null ? r.stars : 0) ? '‚òÖ' : '‚òÜ'}"></span>
                        </div>
                        <div class="org-name" th:text="${currentOrg.name}">T√™n t·ªï ch·ª©c</div>
                    </div>
                </div>

                <div class="actions">
                    <a class="btn ghost" th:href="@{'/ratings/edit/' + ${r.id}}">Ch·ªânh s·ª≠a</a>
                </div>
            </div>
        </section>

        <div style="margin-top:20px;display:flex;justify-content:center;gap:6px;" th:if="${totalPages > 1}">
            <a th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
               th:href="@{/ratings(page=${i}, keyword=${keyword}, stars=${filteredStars}, size=${pageSize})}"
               th:text="${i + 1}"
               th:classappend="${i == currentPage} ? ' btn primary' : ' btn ghost'">1</a>
        </div>
    </main>
</div>
<script th:src="@{/js/rate.js}">

</script>
</body>
</html>
