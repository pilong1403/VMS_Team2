<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">

<head>
    <meta charset="UTF-8" />
    <title>Chi tiết đơn ứng tuyển</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>

<body>
    <div class="container mt-5">
        <h2 class="mb-4 text-center">Chi tiết đơn ứng tuyển</h2>

        <div th:if="${error}" class="alert alert-danger text-center" th:text="${error}"></div>

        <div th:if="${application}" class="card">
            <div class="card-body">

                <h5 class="card-title text-center"
                    th:text="${application.opportunity != null ? application.opportunity.title : 'Không có dữ liệu'}">
                </h5>

                <ul class="list-group mb-3">
                    <li class="list-group-item"><strong>Tên cơ hội:</strong>
                        <span th:text="${application.opportunity != null ? application.opportunity.title : '-'}"></span>
                    </li>
                    <li class="list-group-item"><strong>Tổ chức:</strong>
                        <span
                            th:text="${application.opportunity != null && application.opportunity.organization != null ? application.opportunity.organization.name : '-'}"></span>
                    </li>
                    <li class="list-group-item"><strong>Phụ đề:</strong>
                        <span
                            th:text="${application.opportunity != null ? application.opportunity.subtitle : '-'}"></span>
                    </li>
                    <li class="list-group-item"><strong>Địa điểm:</strong>
                        <span
                            th:text="${application.opportunity != null ? application.opportunity.location : '-'}"></span>
                    </li>
                    <li class="list-group-item"><strong>Họ và tên:</strong>
                        <span th:text="${application.volunteer != null ? application.volunteer.fullName : '-'}"></span>
                    </li>
                    <li class="list-group-item"><strong>Trạng thái:</strong>
                        <span th:text="${application.status != null ? application.status : '-'}"></span>
                    </li>
                    <li class="list-group-item"><strong>Lý do ứng tuyển:</strong>
                        <span th:text="${application.reason != null ? application.reason : '-'}"></span>
                    </li>
                </ul>

                <p><strong>Ngày nộp:</strong>
                    <span
                        th:text="${application.appliedAt != null ? #temporals.format(application.appliedAt, 'dd/MM/yyyy HH:mm') : '-'}"></span>
                </p>

                <p th:if="${application.cancelReason != null}">
                    <strong>Lý do huỷ:</strong> <span th:text="${application.cancelReason}"></span>
                </p>

                <div class="d-flex justify-content-end mt-4 gap-2">
                    <form th:action="@{'/applications/mine/' + ${application.volunteer.userId}}" method="get"
                        th:if="${application.volunteer != null}">
                        <button type="submit" class="btn btn-outline-primary">Quay lại</button>
                    </form>

                    <form th:action="@{'/applications/cancel/' + ${application.appId}}" method="post"
                        th:if="${application != null}">
                        <button type="button" class="btn btn-danger" onclick="confirmCancel(this.form)">Huỷ bỏ</button>
                    </form>
                </div>

                <script>
                    function confirmCancel(form) {
                        if (confirm('Bạn có chắc chắn muốn huỷ đơn này? Việc huỷ sẽ bị đánh giá uy tín thấp.')) {
                            form.submit();
                        }
                    }
                </script>
            </div>
        </div>
    </div>
</body>

</html>